<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存 | 震雨 luckrain7</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="震雨LuckRain7的博客,Webgis,arcgis,openlayer,css,javascript">
    
    <link rel="preload" href="/assets/css/0.styles.e3e3ee1f.css" as="style"><link rel="preload" href="/assets/js/app.c7a3062b.js" as="script"><link rel="preload" href="/assets/js/2.def1226e.js" as="script"><link rel="preload" href="/assets/js/35.fd269807.js" as="script"><link rel="prefetch" href="/assets/js/10.eb022d0e.js"><link rel="prefetch" href="/assets/js/11.d87ec90f.js"><link rel="prefetch" href="/assets/js/12.25022eb5.js"><link rel="prefetch" href="/assets/js/13.7e62cf24.js"><link rel="prefetch" href="/assets/js/14.71d63741.js"><link rel="prefetch" href="/assets/js/15.a186eae5.js"><link rel="prefetch" href="/assets/js/16.c26e47d2.js"><link rel="prefetch" href="/assets/js/17.24a41e6e.js"><link rel="prefetch" href="/assets/js/18.4d55603e.js"><link rel="prefetch" href="/assets/js/19.3d7acb66.js"><link rel="prefetch" href="/assets/js/20.39e5a184.js"><link rel="prefetch" href="/assets/js/21.3a743343.js"><link rel="prefetch" href="/assets/js/22.8f7d0c9c.js"><link rel="prefetch" href="/assets/js/23.9d27621e.js"><link rel="prefetch" href="/assets/js/24.4236db5e.js"><link rel="prefetch" href="/assets/js/25.c346741e.js"><link rel="prefetch" href="/assets/js/26.87801ddc.js"><link rel="prefetch" href="/assets/js/27.d74dac38.js"><link rel="prefetch" href="/assets/js/28.ebc0ff9e.js"><link rel="prefetch" href="/assets/js/29.6f7e7ce1.js"><link rel="prefetch" href="/assets/js/3.1fb44c63.js"><link rel="prefetch" href="/assets/js/30.5d346de5.js"><link rel="prefetch" href="/assets/js/31.ecfc1007.js"><link rel="prefetch" href="/assets/js/32.304e916c.js"><link rel="prefetch" href="/assets/js/33.1f9cd701.js"><link rel="prefetch" href="/assets/js/34.d5f28779.js"><link rel="prefetch" href="/assets/js/36.f0d55278.js"><link rel="prefetch" href="/assets/js/37.66a56353.js"><link rel="prefetch" href="/assets/js/38.cd8047e4.js"><link rel="prefetch" href="/assets/js/39.40af2348.js"><link rel="prefetch" href="/assets/js/4.d5aec60c.js"><link rel="prefetch" href="/assets/js/40.9fe2f47e.js"><link rel="prefetch" href="/assets/js/41.25142ef0.js"><link rel="prefetch" href="/assets/js/42.e4b03432.js"><link rel="prefetch" href="/assets/js/43.7a81e82d.js"><link rel="prefetch" href="/assets/js/44.5b777211.js"><link rel="prefetch" href="/assets/js/45.df76313f.js"><link rel="prefetch" href="/assets/js/46.298dfa14.js"><link rel="prefetch" href="/assets/js/47.1d24a527.js"><link rel="prefetch" href="/assets/js/48.4b172438.js"><link rel="prefetch" href="/assets/js/49.afd53326.js"><link rel="prefetch" href="/assets/js/5.58a80bee.js"><link rel="prefetch" href="/assets/js/50.74061445.js"><link rel="prefetch" href="/assets/js/51.dc1c12d5.js"><link rel="prefetch" href="/assets/js/52.d57451f2.js"><link rel="prefetch" href="/assets/js/53.43539eed.js"><link rel="prefetch" href="/assets/js/54.2f257ae4.js"><link rel="prefetch" href="/assets/js/55.cbef7143.js"><link rel="prefetch" href="/assets/js/56.f72f594c.js"><link rel="prefetch" href="/assets/js/57.2ec4d13a.js"><link rel="prefetch" href="/assets/js/58.c1aaf2b7.js"><link rel="prefetch" href="/assets/js/59.5592f096.js"><link rel="prefetch" href="/assets/js/6.635eeb25.js"><link rel="prefetch" href="/assets/js/60.002d4aba.js"><link rel="prefetch" href="/assets/js/61.c6b9ab21.js"><link rel="prefetch" href="/assets/js/62.c019cf98.js"><link rel="prefetch" href="/assets/js/63.314979cf.js"><link rel="prefetch" href="/assets/js/64.2f3d3cf5.js"><link rel="prefetch" href="/assets/js/65.f3c7b6ca.js"><link rel="prefetch" href="/assets/js/66.7666dda0.js"><link rel="prefetch" href="/assets/js/67.dbe1c488.js"><link rel="prefetch" href="/assets/js/68.9301bfb8.js"><link rel="prefetch" href="/assets/js/69.2b6a06fb.js"><link rel="prefetch" href="/assets/js/7.93e9d83f.js"><link rel="prefetch" href="/assets/js/70.6fd882a7.js"><link rel="prefetch" href="/assets/js/71.6ca6a021.js"><link rel="prefetch" href="/assets/js/72.642b739d.js"><link rel="prefetch" href="/assets/js/73.b0ea0104.js"><link rel="prefetch" href="/assets/js/74.c4d2886f.js"><link rel="prefetch" href="/assets/js/75.4c54359d.js"><link rel="prefetch" href="/assets/js/76.b37742f1.js"><link rel="prefetch" href="/assets/js/77.31bcc17b.js"><link rel="prefetch" href="/assets/js/78.147baea7.js"><link rel="prefetch" href="/assets/js/79.893cf28a.js"><link rel="prefetch" href="/assets/js/8.e04ed01c.js"><link rel="prefetch" href="/assets/js/80.b2c809bc.js"><link rel="prefetch" href="/assets/js/81.48ea7bd2.js"><link rel="prefetch" href="/assets/js/82.6f3157f3.js"><link rel="prefetch" href="/assets/js/83.1ec3961f.js"><link rel="prefetch" href="/assets/js/84.afbff377.js"><link rel="prefetch" href="/assets/js/85.1a993718.js"><link rel="prefetch" href="/assets/js/86.e5f0da21.js"><link rel="prefetch" href="/assets/js/87.48439576.js"><link rel="prefetch" href="/assets/js/88.6017d6e0.js"><link rel="prefetch" href="/assets/js/89.8251406b.js"><link rel="prefetch" href="/assets/js/9.56473944.js"><link rel="prefetch" href="/assets/js/90.b081c342.js"><link rel="prefetch" href="/assets/js/91.a4f50fa1.js"><link rel="prefetch" href="/assets/js/92.2405f030.js"><link rel="prefetch" href="/assets/js/93.a76eee26.js"><link rel="prefetch" href="/assets/js/94.456baca9.js"><link rel="prefetch" href="/assets/js/95.b3ed35d3.js"><link rel="prefetch" href="/assets/js/96.c6525a75.js"><link rel="prefetch" href="/assets/js/97.7f34c71e.js"><link rel="prefetch" href="/assets/js/98.e90d87bf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e3e3ee1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">震雨 luckrain7</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home/" class="nav-link">
    个人介绍
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/HTML.html" class="nav-link">
    HTML
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/CSS.html" class="nav-link">
    CSS
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/JavaScript.html" class="nav-link">
    JavaScript
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/TypeScript.html" class="nav-link">
    TypeScript
  </a></li><li class="dropdown-item"><!----> <a href="/Vue/Vue.html" class="nav-link">
    Vue
  </a></li><li class="dropdown-item"><!----> <a href="/React/React/" class="nav-link">
    React
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/Webpack/" class="nav-link">
    Webpack
  </a></li></ul></div></div><div class="nav-item"><a href="/engineering/engineering/" class="nav-link">
    前端工程化
  </a></div><div class="nav-item"><a href="/server/Node/" class="nav-link">
    Node.js
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="必备工具" class="dropdown-title"><span class="title">必备工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="必备工具" class="mobile-dropdown-title"><span class="title">必备工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/Git.html" class="nav-link">
    Git
  </a></li><li class="dropdown-item"><!----> <a href="/tools/Mac.html" class="nav-link">
    Mac
  </a></li><li class="dropdown-item"><!----> <a href="/tools/GitHub.html" class="nav-link">
    GitHub
  </a></li><li class="dropdown-item"><!----> <a href="/tools/vscode.html" class="nav-link">
    VS Code
  </a></li><li class="dropdown-item"><!----> <a href="/tools/package.html" class="nav-link">
    包管理器
  </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人分享" class="dropdown-title"><span class="title">个人分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人分享" class="mobile-dropdown-title"><span class="title">个人分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/index.html" class="nav-link">
    文章
  </a></li><li class="dropdown-item"><!----> <a href="/share/opensource.html" class="nav-link">
    开源项目
  </a></li><li class="dropdown-item"><!----> <a href="/share/software/" class="nav-link">
    软件推荐
  </a></li><li class="dropdown-item"><!----> <a href="/share/website.html" class="nav-link">
    网站推荐
  </a></li><li class="dropdown-item"><!----> <a href="/frame/index.html" class="nav-link">
    前端工具框架推荐
  </a></li><li class="dropdown-item"><!----> <a href="/share/config/" class="nav-link">
    配置文件
  </a></li><li class="dropdown-item"><!----> <a href="/share/shortcuts.html" class="nav-link">
    快捷键
  </a></li></ul></div></div> <a href="https://github.com/LuckRain7" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home/" class="nav-link">
    个人介绍
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/HTML.html" class="nav-link">
    HTML
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/CSS.html" class="nav-link">
    CSS
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/JavaScript.html" class="nav-link">
    JavaScript
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/TypeScript.html" class="nav-link">
    TypeScript
  </a></li><li class="dropdown-item"><!----> <a href="/Vue/Vue.html" class="nav-link">
    Vue
  </a></li><li class="dropdown-item"><!----> <a href="/React/React/" class="nav-link">
    React
  </a></li><li class="dropdown-item"><!----> <a href="/frontend/Webpack/" class="nav-link">
    Webpack
  </a></li></ul></div></div><div class="nav-item"><a href="/engineering/engineering/" class="nav-link">
    前端工程化
  </a></div><div class="nav-item"><a href="/server/Node/" class="nav-link">
    Node.js
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="必备工具" class="dropdown-title"><span class="title">必备工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="必备工具" class="mobile-dropdown-title"><span class="title">必备工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/Git.html" class="nav-link">
    Git
  </a></li><li class="dropdown-item"><!----> <a href="/tools/Mac.html" class="nav-link">
    Mac
  </a></li><li class="dropdown-item"><!----> <a href="/tools/GitHub.html" class="nav-link">
    GitHub
  </a></li><li class="dropdown-item"><!----> <a href="/tools/vscode.html" class="nav-link">
    VS Code
  </a></li><li class="dropdown-item"><!----> <a href="/tools/package.html" class="nav-link">
    包管理器
  </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人分享" class="dropdown-title"><span class="title">个人分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人分享" class="mobile-dropdown-title"><span class="title">个人分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/index.html" class="nav-link">
    文章
  </a></li><li class="dropdown-item"><!----> <a href="/share/opensource.html" class="nav-link">
    开源项目
  </a></li><li class="dropdown-item"><!----> <a href="/share/software/" class="nav-link">
    软件推荐
  </a></li><li class="dropdown-item"><!----> <a href="/share/website.html" class="nav-link">
    网站推荐
  </a></li><li class="dropdown-item"><!----> <a href="/frame/index.html" class="nav-link">
    前端工具框架推荐
  </a></li><li class="dropdown-item"><!----> <a href="/share/config/" class="nav-link">
    配置文件
  </a></li><li class="dropdown-item"><!----> <a href="/share/shortcuts.html" class="nav-link">
    快捷键
  </a></li></ul></div></div> <a href="https://github.com/LuckRain7" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/cache/" aria-current="page" class="sidebar-link">缓存</a></li><li><a href="/cache/browser-cache.html" aria-current="page" class="active sidebar-link">浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cache/browser-cache.html#_1-强缓存" class="sidebar-link">1. 强缓存</a></li><li class="sidebar-sub-header"><a href="/cache/browser-cache.html#_2-协商缓存" class="sidebar-link">2. 协商缓存</a></li><li class="sidebar-sub-header"><a href="/cache/browser-cache.html#_3-localstorage-sessionstorage-cookie" class="sidebar-link">3. LocalStorage / sessionStorage / cookie</a></li></ul></li><li><a href="/cache/cdn-cache.html" class="sidebar-link">CDN 缓存</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h1> <p><strong>HTTP 缓存又分为强缓存和协商缓存：</strong></p> <ul><li>首先通过 Cache-Control 验证强缓存是否可用，如果强缓存可用，那么直接读取缓存</li> <li>如果不可以，那么进入协商缓存阶段，发起 HTTP 请求，服务器通过请求头中是否带上 If-Modified-Since 和 If-None-Match 这些条件请求字段检查资源是否更新：
<ul><li>若资源更新，那么返回资源和 200 状态码</li> <li>如果资源未更新，那么告诉浏览器直接使用缓存获取资源</li></ul></li></ul> <p><strong>强缓存和协商缓存请求头：</strong></p> <ul><li>强缓存：Expires | Cache-Control
<ul><li>memory cache 内存缓存，一般存放 js，刷新网页</li> <li>disk cache 硬盘缓存，一般存放 css，重新打开网页</li></ul></li> <li>协商缓存：e-tag | Last-modified</li></ul> <p><strong>浏览器加载资源，根据资源的 <code>http</code> <code>header</code> 判断是否命中强缓存；</strong></p> <ul><li>若命中：浏览器直接从自己缓存中读取资源，不会发生 <code>http</code> 请求到服务器；</li> <li>没有命中：浏览器会发送请求到服务器，通过服务器中 <code>http</code> <code>header</code> 验证这个资源是否命中<strong>协商缓存</strong>；
<ul><li>命中：请求返回，但不返回资源，告诉客户端可直接从缓存中加载；</li> <li>没有命中：请求返回，返回资源；</li></ul></li></ul> <p>可以得出：强缓存与协商缓存区别：强缓存不发生请求到服务器，协商缓存会发请求到服务器。</p> <h2 id="_1-强缓存"><a href="#_1-强缓存" class="header-anchor">#</a> 1. 强缓存</h2> <p><strong>页面的缓存状态是由 header 决定的</strong>，header 的参数有四种：</p> <h3 id="_1-1-cache-control-重要策略"><a href="#_1-1-cache-control-重要策略" class="header-anchor">#</a> 1.1 Cache-Control（重要策略）</h3> <ul><li>max-age
<ul><li>（单位为 s）指定设置缓存最大的有效时间，定义的是时间长短</li> <li>max-age=2592000 缓存 30 天，即使服务器上的资源发生了变化，浏览器也不会得到通知。</li> <li>max-age 会覆盖掉 Expires</li></ul></li> <li>s-maxage
<ul><li>（单位为 s）同 max-age，只用于共享缓存（比如 CDN 缓存）。</li> <li>也就是说 max-age 用于普通缓存，而 s-maxage 用于代理缓存。</li> <li>如果存在 s-maxage，则会覆盖掉 max-age 和 Expires header。</li></ul></li> <li>public
<ul><li>指定响应会被缓存，并且在多用户间共享。</li> <li>如果没有指定 public 还是 private，则默认为 public。</li> <li>浏览器 -&gt; 缓存 -&gt; 服务器（先访问缓存，没有在访问服务器）</li></ul></li> <li>private
<ul><li>响应只作为私有的缓存（见下图），不能在用户间共享。</li></ul></li> <li>no-cache
<ul><li>指定不缓存响应，表明资源不进行缓存</li></ul></li> <li>no-store
<ul><li>绝对禁止缓存</li></ul></li> <li>must-revalidate
<ul><li>指定如果页面是过期的，则去服务器进行获取。</li></ul></li></ul> <h3 id="_1-2-expires"><a href="#_1-2-expires" class="header-anchor">#</a> 1.2 Expires</h3> <p>example： <code>Expires: Wed, 01 Mar 2017 11:20:22 GMT</code></p> <p>缓存过期时间，用来指定资源到期的时间，是服务器端的具体的时间点。也就是说，Expires=max-age + 请求时间，需要和 Last-modified 结合使用。但在上面我们提到过，cache-control 的优先级更高。</p> <h2 id="_2-协商缓存"><a href="#_2-协商缓存" class="header-anchor">#</a> 2. 协商缓存</h2> <blockquote><p>协商缓存浏览器响应 Code 是 304</p></blockquote> <h3 id="_2-1-last-modified"><a href="#_2-1-last-modified" class="header-anchor">#</a> 2.1 Last-modified</h3> <ol><li><p>浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，会在 <code>Respone</code> 的 <code>Header</code> 的 <code>Last-Modified</code> 值设置为，该资源最后修改的时间；</p></li> <li><p>第二次请求的时候，在 <code>Request</code> 的 <code>Header</code> 上加上 <code>If-Modified-Since</code>，值为上次请求资源的 <code>Last-Modified</code>；</p></li> <li><p>服务器收到 <code>If-Modified-Since</code> 与服务器文件的 <code>Last-Modified</code> 比对，</p> <ol><li>命中：无变化则返回 <code>304</code> ，不返回资源。浏览器收到 <code>304</code> 使用本地缓存；不更新 <code>Last-Modified</code> ；</li> <li>不命中：有变化返回 <code>200</code> ，重新更新 <code>Last-Modified</code> 、返回 <code>200</code> 、返回资源。</li></ol></li></ol> <p>服务器端文件的最后修改时间，需要和 cache-control 共同使用，是检查服务器端资源是否更新的一种方式。当浏览器再次进行请求时，会向服务器传送 If-Modified-Since 报头，询问 Last-Modified 时间点之后资源是否被修改过。如果没有修改，则返回码为 304，使用缓存；如果修改过，则再次去服务器请求资源，返回码和首次请求相同为 200，资源为服务器最新资源。</p> <h3 id="_2-2-etag"><a href="#_2-2-etag" class="header-anchor">#</a> 2.2 ETag</h3> <blockquote><p>Etag 是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)。</p></blockquote> <ul><li><p>1、浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，会在 <code>Respone</code> 的 <code>Header</code> 的 <code>ETag</code> 值设置为，该资源当前资源文件的一个唯一标识；</p></li> <li><p>2、第二次请求的时候，在 <code>Request</code> 的 <code>Header</code> 上加上 <code>If-None-Match</code>，值为上次请求资源的 <code>ETag</code>；</p></li> <li><p>3、服务器收到 <code>If-None-Match</code> 与服务器文件的 <code>ETag</code> 比对，</p> <ul><li>命中：一致则返回 <code>304</code>，代表资源无更新，故不返回资源。浏览器将会收到 <code>304</code> 使用本地缓存；更新 <code>ETag</code>；</li> <li>不命中：不一致返回 <code>200</code>，重新更新 <code>ETag</code>、返回 <code>200</code>、返回资源。</li></ul></li></ul> <p>根据实体内容生成一段 hash 字符串，标识资源的状态，由服务端产生。浏览器会将这串字符串传回服务器，验证资源是否已经修改，如果没有修改，过程如下：</p> <ul><li><p>客户端 --&gt;&gt; 请求页面 A --&gt;&gt; 服务器端</p></li> <li><p>客户端 &lt;&lt;-- 页面 A+ETag &lt;&lt;-- 服务器端</p></li> <li><p>客户端 --&gt;&gt; 再次请求页面 A+ETag --&gt;&gt; 服务器端</p></li> <li><p>服务器端 检查 ETag</p></li> <li><p>客户端 &lt;&lt;-- 304+空响应 &lt;&lt;-- 服务器端</p></li></ul> <p>使用 ETag 可以解决 Last-modified 存在的一些问题：</p> <div class="language- extra-class"><pre class="language-text"><code>a、某些服务器不能精确得到资源的最后修改时间，这样就无法通过最后修改时间判断资源是否更新
b、如果资源修改非常频繁，在秒以下的时间内进行修改，而Last-modified只能精确到秒
c、一些资源的最后修改时间改变了，但是内容没改变，使用ETag就认为资源还是没有修改的。
</code></pre></div><h3 id="_2-3-e-tag-和-last-modified-优先级"><a href="#_2-3-e-tag-和-last-modified-优先级" class="header-anchor">#</a> 2.3 e-tag 和 Last-Modified 优先级</h3> <p>Last-Modified 与 ETag 是可以一起使用的（见下图），<strong>服务器会优先验证</strong> ETag ，一致的情况下，才会继续比对 Last-Modified，最后才决定是否返回 304 Not Modified。</p> <p>ETag 可以解决 Last-Modified 存在的一些问题，<strong>既生 <code>Last-Modified</code> 何生 <code>ETag</code> ?</strong></p> <ul><li><p>文件内容不更改，但修改时间发生改变，这时候不希望客户端认为这个文件修改了。</p></li> <li><p>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说 <code>1S</code> 内修改了 <code>N</code> 次)，<code>If-Modified-Since</code> 能检查到的粒度是 <code>S</code> 级的，这种修改无法判断；</p></li> <li><p>某些服务器不能精确的得到文件的最后修改时间。</p></li></ul> <h2 id="_3-localstorage-sessionstorage-cookie"><a href="#_3-localstorage-sessionstorage-cookie" class="header-anchor">#</a> 3. LocalStorage / sessionStorage / cookie</h2> <p>除了开头提到的那么多缓存方式以外，还有一种我们都熟悉的缓存方式，<strong>LocalStorage 和 sessionStorage</strong>。</p> <p>LocalStorage 是一种本地存储的公共资源，域名下很多应用共享这份资源会有风险；LocalStorage 是以页面域名划分的，如果有多个等价域名之间的 LocalStorage 不互通，则会造成缓存多份浪费。</p> <p>LocalStorage 在 PC 上的兼容性不太好，而且当网络速度快、协商缓存响应快时使用 localStorage 的速度比不上 304。并且不能缓存 css 文件。而移动端由于网速慢，使用 localStorage 要快于 304。</p> <p>而相对 LocalStorage 来说，SessionStorage 的数据只存储到特定的会话中，不属于持久化的存储，所以关闭浏览器会清除数据。和 localstorage 具有相同的方法。</p> <p>在前端开发中缓存是必不可少的，那么使用怎样的缓存方式更高效、让我们项目的性能更优，还是需要我们仔细斟酌。</p> <h3 id="_3-1-三者区别"><a href="#_3-1-三者区别" class="header-anchor">#</a> 3.1 三者区别</h3> <ol><li><p>都会在浏览器端保存，有大小限制，同源限制</p></li> <li><p>cookie 会在请求时发送到服务器，作为会话标识，服务器可修改 cookie；web storage 不会发送到服务器</p></li> <li><p>cookie 有 path 概念，子路径可以访问父路径 cookie，父路径不能访问子路径 cookie</p></li> <li><p>有效期：cookie 在设置的有效期内有效，默认为浏览器关闭；sessionStorage 在窗口关闭前有效，localStorage 长期有效，直到用户删除</p></li> <li><p>共享：sessionStorage 不能共享，localStorage 在同源文档之间共享，cookie 在同源且符合 path 规则的文档之间共享</p></li> <li><p>localStorage 的修改会促发其他文档窗口的 update 事件</p></li> <li><p>cookie 有 secure 属性要求 HTTPS 传输</p></li> <li><p>浏览器不能保存超过 300 个 cookie，单个服务器不能超过 20 个，每个 cookie 不能超过 4k。web storage 大小支持能达到 5M</p></li></ol> <hr> <p>参考文章:</p> <ul><li><a href="https://juejin.cn/post/6844903546119258125" target="_blank" rel="noopener noreferrer">浏览器缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844904067882287111" target="_blank" rel="noopener noreferrer">浏览器缓存之强缓存与协商缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cache/" class="prev router-link-active">
          缓存
        </a></span> <span class="next"><a href="/cache/cdn-cache.html">
          CDN 缓存
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.c7a3062b.js" defer></script><script src="/assets/js/2.def1226e.js" defer></script><script src="/assets/js/35.fd269807.js" defer></script>
  </body>
</html>
